/*
 * jQuery plugin: fieldSelection - v0.1.0 - last change: 2006-12-16
 * (c) 2006 Alex Brem <alex@0xab.cd> - http://blog.0xab.cd
 */
(function(){var c={getSelection:function(){var e=this.jquery?this[0]:this;return(('selectionStart'in e&&function(){var l=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:l,text:e.value.substr(e.selectionStart,l)}})||(document.selection&&function(){e.focus();var r=document.selection.createRange();if(r==null){return{start:0,end:e.value.length,length:0}}var a=e.createTextRange();var b=a.duplicate();a.moveToBookmark(r.getBookmark());b.setEndPoint('EndToStart',a);return{start:b.text.length,end:b.text.length+r.text.length,length:r.text.length,text:r.text}})||function(){return{start:0,end:e.value.length,length:0}})()},replaceSelection:function(){var e=this.jquery?this[0]:this;var a=arguments[0]||'';return(('selectionStart'in e&&function(){e.value=e.value.substr(0,e.selectionStart)+a+e.value.substr(e.selectionEnd,e.value.length);return this})||(document.selection&&function(){e.focus();document.selection.createRange().text=a;return this})||function(){e.value+=a;return this})()}};jQuery.each(c,function(i){jQuery.fn[i]=this})})();(function($){$.fn.tabSupport=function(){var CAR_RETURN='\n';var TAB='\t';this.keydown(function(event){if(event.which==9){event.preventDefault();var pos=$(this).getSelection();scrollLoc=$(this)[0].scrollTop;pos.start=pos.start+1;pos.end=pos.end+1;$(this).replaceSelection(TAB);if(!$.browser.msie)positionCursor($(this),pos,buildTabs($(this).val(),pos));$(this)[0].scrollTop=scrollLoc}});function buildTabs(data,pos){var prevLineEnd=data.substring(0,pos.end).lastIndexOf(CAR_RETURN);var prevLineStart=($.browser.msie)?data.substring(0,prevLineEnd-1).lastIndexOf(CAR_RETURN):data.substring(0,prevLineEnd-1).lastIndexOf(CAR_RETURN)+1;if(data.charCodeAt(prevLineStart)==10)prevLineStart++;var tabs='';var tc=0;for(var i=prevLineStart;i<=prevLineEnd;i++){if(data.charAt(i)!=TAB)break;tabs+=TAB;tc++}$("#tabCount").val(tc);return tabs}function positionCursor(obj,pos,tabs){if(obj[0].setSelectionRange){obj[0].setSelectionRange(pos.start+tabs.length,pos.end+tabs.length)}else if(obj[0].createTextRange){var range=obj[0].createTextRange();range.collapse(true);range.moveEnd('character',pos.start);range.moveStart('character',pos.end);range.select()}}}})(jQuery);